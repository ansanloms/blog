<!DOCTYPE html>
<html lang="ja"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>PC のセットアップをしました</title><script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/prism.min.js"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/themes/prism.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ress@5.0.2/dist/ress.min.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@100;300;400;500;700;900&amp;display=swap"><link rel="stylesheet" href="/styles/main.css"><link rel="stylesheet" href="/styles/article.css"></head><body><header><a href="/">ansanloms blog</a></header><div class="container"><article class="article"><h1>PC のセットアップをしました</h1><div><p>OS のクリーンインストールをしました。</p>
<p>今後の為に PC のセットアップについてまとめようとおもいます。</p>
<h2>環境</h2>
<p>Winodws 10 Pro バージョン 20H2 です。</p>
<h2>かんがえていること</h2>
<ul>
<li>CLI のうえでやっていきたいです。</li>
<li>ある程度自動化したいです。</li>
<li>あくまで Windows 上でやっていきたいです。</li>
</ul>
<h2>scoop のインストール</h2>
<p><a href="https://scoop.sh/">https://scoop.sh/</a></p>
<p>scoop を導入します。 Windows 上でパッケージ管理できるすごいやつです。</p>
<p>公式サイトにある通りインストールします。</p>
<pre class="language-none" tabindex="0"><code class="language-none">iwr -useb get.scoop.sh | iex
</code></pre>
<h3>パッケージのインストール</h3>
<p>あとはどんどんインストールしていきます。基本的に <code>%USERPROFILE%\scoop\apps</code> 下にインストールされていきます。</p>
<pre class="language-none" tabindex="0"><code class="language-none">scoop instal git
scoop instal vim-nightly
...
</code></pre>
<p>インストールできるアプリの設定(<a href="https://github.com/lukesampson/scoop/wiki/App-Manifests">Manifest</a>
といいます)を纏めた単位を <a href="https://github.com/lukesampson/scoop/wiki/Buckets">Bucket</a>
といい、公式や有志の方々が用意してくれた Bucket を追加することによりインストールできるアプリが増えます。また Manifest
が用意されていないアプリに関しては自分で Bucket を用意したりします。</p>
<pre class="language-none" tabindex="0"><code class="language-none">scoop bucket add extras
scoop bucket add versions
scoop bucket add nightlies

scoop bucket add pleiades https://github.com/jfut/scoop-pleiades.git
scoop bucket add ansanloms https://github.com/ansanloms/scoop-ansanloms.git
...


scoop install googlechrome-dev
scoop install windows-terminal
scoop install pleiades2020-java-win-full
...
</code></pre>
<p>これで必要なアプリはあらかた用意ができます。設定した Bucket および Manifest
をメモっておけば次回のセットアップ時もスムーズにアレできてよいです。</p>
<h3>パッケージのアンインストールと更新</h3>
<p>アンインストールや更新は以下のとおりにします。</p>
<pre class="language-none" tabindex="0"><code class="language-none">scoop uninstall &lt;Manifest&gt;
scoop update &lt;Manifest&gt;
</code></pre>
<p><code>scoop update *</code> でインストールしているアプリを全て更新します。朝 PC の前に座ったらおもむろに実行したりしなかったりします。</p>
<p>scoop による更新は、基本的に現行インストールされているアプリとは別に新しいバージョンをインストールされます。
<code>%USERPROFILE%\scoop\apps\&lt;Manifest&gt;</code> を見ると今までインストールしてきた全てのバージョンが確認できるはずです。例えば
Android Studio とか容量が大きいアプリとかだと HDD
を切迫する原因になりうるので、任意のタイミングで不要になったバージョンを削除する必要があったりします。</p>
<h2>nyagos のインストール</h2>
<p><a href="https://github.com/zetamatta/nyagos">https://github.com/zetamatta/nyagos</a></p>
<p>基本的に CLI のうえでやっていきたいです。けど cmd や PowerShell のうえはちょっとだけつらいです。とはいえ Cygwin とか WSL
とかじゃなくて Windows のうえにいたいです。たとえば <code>C:\</code> てきなドライブレター UNC パスとか見えていたいです。</p>
<p>そこで nyagos でやっていきます。 UNIX っぽいことができるとてもすごいコマンドラインシェルです。</p>
<p>scoop の <code>main</code> Bucket にあります。</p>
<pre class="language-none" tabindex="0"><code class="language-none">scoop install nyagos
</code></pre>
<h2>msys2 のインストール</h2>
<p><a href="https://www.msys2.org/">https://www.msys2.org/</a></p>
<p>Windows (nyagos)上でも <code>find</code> とか <code>grep</code> とかでやっていきたいときもあるので msys2
を導入します。取り急ぎはその為だけにいれるのでそれなら <a href="https://github.com/bmatzelle/gow">Gow</a>
とかでもいいんですけど、今後それ以上のことに使うつもりなので msys2 を入れます。</p>
<p>scoop で入ります。</p>
<pre class="language-none" tabindex="0"><code class="language-none">scoop install msys2
</code></pre>
<h3>msys2 の設定</h3>
<p>初回起動後に一旦閉じて再度起動します。 Windows 上のホームディレクトリに相乗りしたいので <code>/etc/fstab</code> にその旨マウント設定を記述します。</p>
<pre class="language-none" tabindex="0"><code class="language-none">echo "C:/Users /home" &gt;&gt; /etc/fstab
</code></pre>
<p>現行の各種パッケージを更新し、取り急ぎ <a href="https://packages.msys2.org/group/base-devel">base-devel</a>
パッケージグループをインストールします。 base-devel には <code>grep</code> や <code>awk</code> 、 <code>sed</code> 等そういうのがはいっています。</p>
<pre class="language-none" tabindex="0"><code class="language-none">pacman -Syuu
pacman -S base-devel
</code></pre>
<h3>nyagos 側の設定</h3>
<p>msys2 上に導入した各種コマンドを Windows (nyagos) 上で利用できるようにします。</p>
<p>nyagos の各種設定は <code>%USERPROFILE%\.nyagos</code> に記述します。環境変数 <code>PATH</code> に msys2 のパスを追加します。</p>
<pre class="language-none" tabindex="0"><code class="language-lua:.nyagos language-none">nyagos.env.path = nyagos.env.path .. ";" .. nyagos.env.homedrive .. nyagos.env.homepath .. "\\scoop\\apps\\msys2\\current\\usr\\bin"
nyagos.env.path = nyagos.env.path .. ";" .. nyagos.env.homedrive .. nyagos.env.homepath .. "\\scoop\\apps\\msys2\\current\\mingw64\\bin"
</code></pre>
<p>DOS コマンドとバッティングするコマンドはエイリアス設定をします。けどなんかもっといい解決案があるはずです。</p>
<pre class="language-none" tabindex="0"><code class="language-lua:.nyagos language-none">nyagos.alias.echo = [[~\scoop\apps\msys2\current\usr\bin\echo.exe]]
nyagos.alias.find = [[~\scoop\apps\msys2\current\usr\bin\find.exe]]
</code></pre>
<p>これで nyagos 上から msys2 上に導入したコマンドが実行できるようになってとてもよいです。</p>
<h3>nyagos のプロンプトをいい感じにする</h3>
<p>nyagos のプロンプト設定は <code>%USERPROFILE%\.nyagos</code> 上の nyagos.prompt
で設定します。自前でどうにかするのもいいですが今回は <a href="https://starship.rs/">StarShip</a> でやっていきます。</p>
<p>例によって scoop でインストールできます。</p>
<pre class="language-none" tabindex="0"><code class="language-none">scoop install starship
</code></pre>
<p><code>%USERPROFILE%\.nyagos</code> に以下の通り追記します。 nyagos を再度起動するとプロンプトがいい感じになります。</p>
<pre class="language-none" tabindex="0"><code class="language-lua:.nyagos language-none">nyagos.prompt = function(this)
    -- ターミナルに表示するタイトル
    -- 取り急ぎカレントディレクトリのパスを表示する
    local title = "NYAGOS - " .. nyagos.getwd():gsub("\\", "/")

    -- プロンプト starship を使う
    local prompt = "\n" .. nyagos.eval("starship prompt 2&gt; nul") .. " "

    return nyagos.default_prompt(prompt, title)
end
</code></pre>
<h2>おわり</h2>
<p>よかったですね。</p>
</div></article></div><footer>(C) <a href="https://twitter.com/ansanloms">ansanloms</a></footer></body></html>